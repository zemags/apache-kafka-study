#### концепции (продюсер - брокер - консьюмер)
	- кафка - распределенная паблиш-сабскрайб сообщений система
	- брокер - получает сообщений от продюссеров раскидывает на консьюмеров
	- кластер брокеров - несколько брокеров, в случае падения чтобы были запасные, либо разные критерии по типу заданий для каждого брокера
		- брокера синхранизируеются с помозью zookeeper
	- zookeeper - контролит брокеров, знает всех брокеров, мэнэджерит конфиги для топиков и партиций
		- кластер зоокиперов - zookeeper cluster (ensemble) - несколько штук
			- quorum - определяет при сколькои неработающих кластеров все падает, целое число
				- нужно чтобы было нечетное число серверов в зукипире
				- quorum = (кол-во сервисов + 1)/2

#### множественные кластеры кафки, то что выше но допустим этих  сущеностей больше
	- повышает ээфективность и понижает нагрузку

#### дефолт порты
	- зукипер localhost:2181
	- кафка localhost:9092
	- на каждый зукипер или кафка инстанс свой конфиг

#### кафка топики
- у каждого топика свое имя
- топик это куда помещаются сообщения в порядке прибытия на выход в порядке очереди
- у каждого сообщения свой номер
- старые сообщения дропаются если time expired

#### структура сообщения
- timestamp
- offset number уникальное между партициями
- key - опционально
- value - последовательность байтов
- идея держать сообщения как можно меньше, чтобы достигнуть эффективности кластера апачи

#### топики и партиции
- топик может быть в разных брокерах одновременно
	- это для того чтобы если брокер упал, то другой смог работать с топиком
- партиция - то из чего состоит топик
	- могут быть несколько, и каждая часть партиции на разных брокерах одновременно
	- делять на партиции чтобы, брокеры могли работать быстро с жесктим диском, если дробим топик

#### рассеявать сообщения между партициями
- каждый продюсер может писать в свою партицию, продюсер выбирает
- в случае падения исчезнут сообщения если нет репликации

#### лидер партиции и фоловеры
- лидер брокер создают партицию и клонирует ее на другие брокеры фоловеры, они его реплецируют, чтобы без падний надо чтобы каждое сообщение дважды и были три брокера
- фактор репликации, копии плюс оригинал

#### контроллер и обязанности
- кто решает какой брокер будет лидером, а какие фоловеры
- какой брокер применять на себя реплику партиции если брокер упал и тд
	- это все делает контроллер
	- контроллер - это брокер в кластере, у него просто обязанности для мэнджеринга

#### как продюсер пишет сообщение в топик
- каждый продюсер может писать в разные партиции топика

#### как консьюмер читает сообщения из топика
- читает с партиций(которые могут быть на разных брокерах)
	- ожидания новое сообщения
	- или с самого начала

```bash
kafka/config/producer.properties - start producer
kafka/config/server.properties - server options
kafka/config/zookeeper.properties - run zookeeper
```
```bash
kafka/bin/zookeeper-server-start.sh config/zookeeper.properties - запуск до кафки, слушает 0.0.0.0:2181
kafka/bin/kafka-server-start.sh config/server.properties - запуск кафки
```
	- broker=0 - айди брокера в кластере, слушает 0.0.0.0:9092 дефолтно, можно поменять в kafka/config/server.properties
	- /tmp/kafka-logs - логи сообщений которые в брокере, можно поменять в kafka/config/server.properties

#### kafka/logs/server.log - логи кафки и зоокипера после запуска

#### создание нового топика кафки
- sh bin/kafka-topics.sh --create --bootstrap-server localhost:9092 --topic cities --partitions 1 --replication-factor 1
	- partitions - это для параллелизма, в папке /tmp/kafka-logs/cities-0, если бы было партиций 2 то было бы еще cities-1

#### описание топика
bin/kafka-topics.sh --describe --zookeeper localhost:2181 --topic cities - просмотр инфы о топике
	 - replicationfactor - реплика сервера дефолт 1

#### коннект к брокеру и создание топика - паблишер
	- bin/kafka-console-producer.sh --broker-list localhost:9092 --topic cities

#### консьюмер
	- bin/kafka-console-producer.sh --bootstrap-server localhost:9092 --topic cities
	- bin/kafka-console-producer.sh --bootstrap-server localhost:9092 --topic cities --from-begining чтение с самого начала


- продюссеры не знаю о других продюссерах
- все консьюмеры получат сообщения если продюссер отправил
- каждый консьюмер принадлежит группе консьюмеров

#### где хранятся все сообщения в папке портиции cities-0
- в /tmp/kafka-logs/cities-0/00000(много нулей).log

